<template>
    <div class="slds-grid slds-gutters slds-wrap slds-m-bottom_medium">
        <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2">
            <lightning-input type="text" label="Route ID" value={filterRoute} onchange={handleFilterChange} placeholder="Filter by route ID"></lightning-input>
        </div>
    </div>
    
    <div class="slds-grid slds-gutters slds-m-bottom_medium">
        <div class="slds-col">
            <lightning-button label="Create Leg" icon-name="utility:add" variant="brand" onclick={handleCreate}></lightning-button>
            <lightning-button label="Clear Filters" icon-name="utility:clear" onclick={handleClearFilters} class="slds-m-left_small"></lightning-button>
        </div>
        <div class="slds-col slds-text-align_right">
            <lightning-button label="Upload CSV" icon-name="utility:upload" onclick={handleUpload}></lightning-button>
            <lightning-button label="Export" icon-name="utility:download" onclick={handleExport} class="slds-m-left_small"></lightning-button>
        </div>
    </div>
    
    <template if:true={loading}>
        <lightning-spinner alternative-text="Loading" size="medium"></lightning-spinner>
    </template>
    
    <template if:false={loading}>
        <div class="slds-table_header-fixed_container" style="max-height: 600px;">
            <table class="slds-table slds-table_cell-buffer slds-table_bordered slds-table_striped">
                <thead>
                    <tr class="slds-line-height_reset">
                        <th scope="col" style="width: 80px;"><div class="slds-truncate">Seq</div></th>
                        <th scope="col"><div class="slds-truncate">Route</div></th>
                        <th scope="col"><div class="slds-truncate">Leg Name</div></th>
                        <th scope="col"><div class="slds-truncate">From</div></th>
                        <th scope="col"><div class="slds-truncate">To</div></th>
                        <th scope="col"><div class="slds-truncate">Mode</div></th>
                        <th scope="col"><div class="slds-truncate">Distance</div></th>
                        <th scope="col"><div class="slds-truncate">Transit</div></th>
                        <th scope="col" style="width: 150px;"><div class="slds-truncate">Actions</div></th>
                    </tr>
                </thead>
                <tbody>
                    <template if:true={formattedRecords.length}>
                        <template for:each={formattedRecords} for:item="record">
                            <tr key={record.id} class="slds-hint-parent">
                                <td data-label="Seq"><div class="slds-truncate"><strong>{record.leg_sequence}</strong></div></td>
                                <td data-label="Route"><div class="slds-truncate">{record.routeCode}</div></td>
                                <td data-label="Leg Name"><div class="slds-truncate">{record.leg_name}</div></td>
                                <td data-label="From"><div class="slds-truncate">{record.fromLocationName}</div></td>
                                <td data-label="To"><div class="slds-truncate">{record.toLocationName}</div></td>
                                <td data-label="Mode"><div class="slds-truncate">{record.transport_mode}</div></td>
                                <td data-label="Distance"><div class="slds-truncate">{record.distanceFormatted}</div></td>
                                <td data-label="Transit"><div class="slds-truncate">{record.transitFormatted}</div></td>
                                <td data-label="Actions">
                                    <div class="slds-button-group" role="group">
                                        <lightning-button-icon 
                                            icon-name="utility:preview" 
                                            variant="border-filled" 
                                            alternative-text="View"
                                            data-id={record.id}
                                            onclick={handleView}>
                                        </lightning-button-icon>
                                        <lightning-button-icon 
                                            icon-name="utility:edit" 
                                            variant="border-filled" 
                                            alternative-text="Edit"
                                            data-id={record.id}
                                            onclick={handleEdit}>
                                        </lightning-button-icon>
                                        <lightning-button-icon 
                                            icon-name="utility:delete" 
                                            variant="border-filled" 
                                            alternative-text="Delete"
                                            data-id={record.id}
                                            onclick={handleDelete}>
                                        </lightning-button-icon>
                                    </div>
                                </td>
                            </tr>
                        </template>
                    </template>
                    <template if:false={formattedRecords.length}>
                        <tr><td colspan="9" class="slds-text-align_center"><div class="slds-m-around_medium"><p>No haulage legs found.</p></div></td></tr>
                    </template>
                </tbody>
            </table>
        </div>
        <div class="slds-m-top_small slds-text-body_small slds-text-color_weak">Showing {formattedRecords.length} leg(s)</div>
    </template>
</template>

